<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal do Vendedor</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background: #f4f4f4; }
        .card { background: white; padding: 20px; border-radius: 15px; max-width: 400px; margin: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        h2 { 
            font-family: 'Bebas Neue', sans-serif; 
            font-weight: bold; 
            font-size: 40px; 
            color: #e31d1a;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        img { width: 100%; border-radius: 10px; margin-bottom: 15px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 16px; }
        button { background: #25D366; color: white; border: none; padding: 15px; width: 100%; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 16px; }
        button:hover { background: #128C7E; }
    </style>
</head>
<body>

<div class="card">
    <h2>OFERTA!!</h2>
    <img id="fotoProduto" src="produto.png" alt="Imagem do Produto">
    
    <input type="text" id="cod" placeholder="DIGITE SEU C√ìDIGO">
    <button onclick="enviar()">GERAR E ENVIAR NO WHATSAPP</button>
</div>

<script>
    // --- CONFIGURA√á√ÉO DE RASTREIO ---
    // IMPORTANTE: Use o link COMPLETO do Google Forms, n√£o o encurtado
    const GOOGLE_FORM_URL = "https://docs.google.com/forms/u/0/d/e/1FAIpQLSfdheHBbGMCLIXXAeM0b8rTbpextHznj6BDS6lKGLN9ZMjd4g/formResponse";
    const ENTRY_ID_CODIGO = "entry.2003110990"; // ID da pergunta do C√≥digo
    const ENTRY_ID_BROWSER = "entry.200360405"; // ID da pergunta do Navegador

    // Fun√ß√£o para identificar o navegador
    function getBrowserName() {
        const ua = navigator.userAgent;
        if (ua.includes("SamsungBrowser")) return "Samsung Internet";
        if (ua.includes("Chrome") && !ua.includes("Edg")) return "Chrome";
        if (ua.includes("Safari") && !ua.includes("Chrome") && !ua.includes("Edg")) return "Safari";
        if (ua.includes("Edg")) return "Edge";
        if (ua.includes("Firefox")) return "Firefox";
        if (ua.includes("OPR") || ua.includes("Opera")) return "Opera";
        return "Outro/Desconhecido";
    }

    async function enviar() {
        const codInput = document.getElementById('cod').value.trim().toUpperCase();
        if(!codInput) { 
            alert("Por favor, digite o c√≥digo!"); 
            return; 
        }

        const navegador = getBrowserName();
        
        // Links da Martinello
        const urlProduto = "https://www.martinello.com.br/caixa-de-som-jbl-boombox-4-bluetooth-preto-80878";
        const linkFinal = `https://www.martinello.com.br/parceiros/${codInput}?redir=${encodeURIComponent(urlProduto)}`;
        const textoDaOferta = `üî• Oferta Especial ‚Äì Super Big Friday Martinello! üî•\n\nA Caixa de Som JBL Boombox chegou com um precinho imperd√≠vel!\n\nüëâ Compre aqui: ${linkFinal}`;

        // RASTREIO INVIS√çVEL
        try {
            // Envia dados para o Google Forms
            if(GOOGLE_FORM_URL.includes("formResponse")) {
                const formData = new FormData();
                formData.append(ENTRY_ID_CODIGO, codInput);
                formData.append(ENTRY_ID_BROWSER, navegador);
                
                // Envia usando fetch com no-cors (n√£o vamos esperar resposta)
                fetch(GOOGLE_FORM_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: formData
                });
                
                console.log("Rastreio enviado:", codInput, navegador);
            }
        } catch (error) {
            console.error("Erro no rastreio:", error);
        }

        // TENTATIVA DE COMPARTILHAMENTO
        try {
            const imgElement = document.getElementById('fotoProduto');
            const response = await fetch(imgElement.src);
            const blob = await response.blob();
            
            // Verifica se √© um arquivo de imagem v√°lido
            if (blob.type.startsWith('image/')) {
                const file = new File([blob], 'oferta.png', { type: 'image/png' });

                // Tenta compartilhar com imagem se o navegador suportar
                if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        files: [file],
                        text: textoDaOferta
                    });
                    return; // Sucesso!
                } else {
                    throw new Error('Web Share n√£o suporta arquivos');
                }
            } else {
                throw new Error('Arquivo n√£o √© imagem v√°lida');
            }
        } catch (error) {
            console.log("Usando fallback do WhatsApp:", error);
            // FALLBACK: Abre o WhatsApp apenas com texto
            const msgZap = encodeURIComponent(textoDaOferta);
            window.open(`https://wa.me/?text=${msgZap}`, '_blank');
        }
    }
</script>

</body>
</html>
